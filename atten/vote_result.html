<head 
	<meta charset = "utf-8" />
	<title>ACM Sign-In</title>
    <link rel="shortcut icon" href="Logo.png">
    <link rel="stylesheet" href="StyleSheets/Main.css">
</head>

<script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.3.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.3.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.3.0/firebase-database.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi?autoload= 
{'modules':[{'name':'visualization','version':'1.1','packages':
['corechart']}]}"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {packages: ['corechart']});
  google.charts.setOnLoadCallback(null);
</script>


<H1 id="title" onclick="drawChart(1,2,3)">Sign in to the meeting: <a href="https://goo.gl/ZwVVrM">goo.gl/ZwVVrM</a>
    or <img src="https://goo.gl/ZwVVrM.qr" alt="QR Code" width="150" height="150">
</H1>

<H2 id="signed_in">How many people signed into this meeting: Unknown</H2>
<H2 id="first_meeting">Number of new members: Unknown</H2>

<div id="piechart" ></div>

<script>
  // This is my first time ever writing Javascript or HTML from scratch.
  // Sorry if it's hard to read.
  // Why are you even reading this anyway?

  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAQCEhRC7wf8iCyEW1puwteuWMP5EP7U14",
    authDomain: "acm-attendance.firebaseapp.com",
    databaseURL: "https://acm-attendance.firebaseio.com",
    storageBucket: "acm-attendance.appspot.com",
  };
  firebase.initializeApp(config);
  
  var number = firebase.database().ref('signed_in_count/');
  number.on('value', function(snapshot) {
    var signed_in_value = snapshot.val();
    
    console.log(signed_in_value);
    
    //alert(num);
    document.getElementById("signed_in").innerHTML = "How many people signed into this meeting: " + signed_in_value;
  })
  
  
  var number = firebase.database().ref('new_members_count/');
  number.on('value', function(snapshot) {
    var first_value = snapshot.val();
    
    console.log(first_value);
    
    //alert(num);
    document.getElementById("first_meeting").innerHTML = "Number of new members: " + first_value;
  })
  
  
  var vote_game = 0;
  var vote_android = 0;
  var vote_web = 0;
  var vote_acmw = 0;
  var vote_ai = 0;
  var vote_cpc = 0;
  
  // GAME
  var number = firebase.database().ref('vote/game');
  number.on('value', function(snapshot) {
    vote_game = snapshot.val();
    drawChart();
  })
  
  // ANDROID
  var number = firebase.database().ref('vote/android');
  number.on('value', function(snapshot) {
    vote_android = snapshot.val();
    drawChart();
  })
  
  // WEB
  var number = firebase.database().ref('vote/web');
  number.on('value', function(snapshot) {
    vote_web = snapshot.val();
    drawChart();
  })
  
  // ACMW
  var number = firebase.database().ref('vote/acmw');
  number.on('value', function(snapshot) {
    vote_acmw = snapshot.val();
    drawChart();
  })
  
  // AI
  var number = firebase.database().ref('vote/ai');
  number.on('value', function(snapshot) {
    vote_ai = snapshot.val();
    drawChart();
  })
  
  // CPC
  var number = firebase.database().ref('vote/cpc');
  number.on('value', function(snapshot) {
    vote_cpc = snapshot.val();
    drawChart();
  })
  
  
  
  var comment = firebase.database().ref('comment/');
  comment.on('value', function(snapshot) {
    var value = snapshot.val();
    
    console.log(value);
        
    //alert(num);
    document.getElementById("comment_text").innerHTML = value;
  })
  
  function drawChart() {
    console.log("In draw chart");
  
    if (vote_web > 0 || vote_android > 0 || vote_game > 0 || vote_cpc > 0 || vote_ai > 0 || vote_acmw > 0) {
        var results_array = [['What is the best committee?', 'Votes']];
        
        if(vote_web > 0)
            results_array.push(['Web Dev', vote_web]);
        if(vote_android > 0)
            results_array.push(['Android', vote_android]);
        if(vote_game > 0)
            results_array.push(['Animation/Game Design', vote_game]);
        if(vote_cpc > 0)
            results_array.push(['CPC', vote_cpc]);
        if(vote_ai > 0)
            results_array.push(['AI', vote_ai]);
        if(vote_acmw > 0)
            results_array.push(['ACM-W', vote_acmw]);
           
        console.log(results_array);
            
        
        var data = google.visualization.arrayToDataTable(results_array);

        var options = {
          title: 'What is the best committee?'
        };

        document.getElementById("piechart").innerHTML = "";
        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
    }
  }
  
  google.visualization.events.addListener(chart, 'ready', function() {
            console.log("In listener")
            drawChart()
        });
  
   $(window).load(function() {
    drawChart()
 });
  
  
  
  console.log('END');
</script>
